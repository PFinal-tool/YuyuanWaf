# è´¡çŒ®æŒ‡å—

æ„Ÿè°¢æ‚¨å¯¹å¾¡æ¸ŠWAFé¡¹ç›®çš„å…³æ³¨ï¼æˆ‘ä»¬æ¬¢è¿æ‰€æœ‰å½¢å¼çš„è´¡çŒ®ã€‚

## ğŸ“‹ ç›®å½•

- [è¡Œä¸ºå‡†åˆ™](#è¡Œä¸ºå‡†åˆ™)
- [å¦‚ä½•è´¡çŒ®](#å¦‚ä½•è´¡çŒ®)
- [å¼€å‘æµç¨‹](#å¼€å‘æµç¨‹)
- [ä»£ç è§„èŒƒ](#ä»£ç è§„èŒƒ)
- [æäº¤è§„èŒƒ](#æäº¤è§„èŒƒ)
- [æµ‹è¯•è¦æ±‚](#æµ‹è¯•è¦æ±‚)

---

## è¡Œä¸ºå‡†åˆ™

### æˆ‘ä»¬çš„æ‰¿è¯º

ä¸ºäº†è¥é€ ä¸€ä¸ªå¼€æ”¾å’Œå‹å¥½çš„ç¯å¢ƒï¼Œæˆ‘ä»¬ä½œä¸ºè´¡çŒ®è€…å’Œç»´æŠ¤è€…æ‰¿è¯ºï¼šæ— è®ºå¹´é¾„ã€ä½“å‹ã€æ®‹ç–¾ã€æ°‘æ—ã€æ€§åˆ«è®¤åŒå’Œè¡¨è¾¾ã€ç»éªŒæ°´å¹³ã€å›½ç±ã€ä¸ªäººå½¢è±¡ã€ç§æ—ã€å®—æ•™æˆ–æ€§å–å‘å¦‚ä½•ï¼Œå‚ä¸æˆ‘ä»¬çš„é¡¹ç›®å’Œç¤¾åŒºçš„æ¯ä¸ªäººéƒ½ä¸ä¼šå—åˆ°éªšæ‰°ã€‚

### æˆ‘ä»¬çš„æ ‡å‡†

ç§¯æè¡Œä¸ºåŒ…æ‹¬ï¼š
- ä½¿ç”¨å‹å¥½å’ŒåŒ…å®¹çš„è¯­è¨€
- å°Šé‡ä¸åŒçš„è§‚ç‚¹å’Œç»éªŒ
- ä¼˜é›…åœ°æ¥å—å»ºè®¾æ€§æ‰¹è¯„
- å…³æ³¨å¯¹ç¤¾åŒºæœ€æœ‰åˆ©çš„äº‹æƒ…
- å¯¹å…¶ä»–ç¤¾åŒºæˆå‘˜è¡¨ç¤ºåŒæƒ…

ä¸å¯æ¥å—çš„è¡Œä¸ºåŒ…æ‹¬ï¼š
- ä½¿ç”¨æ€§åŒ–çš„è¯­è¨€æˆ–å›¾åƒ
- æŒ‘è¡…ã€ä¾®è¾±æˆ–è´¬æŸæ€§è¯„è®ºï¼Œä»¥åŠäººèº«æ”»å‡»
- å…¬å¼€æˆ–ç§ä¸‹éªšæ‰°
- æœªç»æ˜ç¡®è®¸å¯å‘å¸ƒä»–äººçš„ç§äººä¿¡æ¯
- å…¶ä»–åœ¨ä¸“ä¸šç¯å¢ƒä¸­å¯èƒ½è¢«è®¤ä¸ºä¸é€‚å½“çš„è¡Œä¸º

---

## å¦‚ä½•è´¡çŒ®

### æŠ¥å‘Šé—®é¢˜

å¦‚æœæ‚¨å‘ç°äº†bugæˆ–æœ‰åŠŸèƒ½å»ºè®®ï¼š

1. **æœç´¢ç°æœ‰Issue** - ç¡®ä¿é—®é¢˜æœªè¢«æŠ¥å‘Š
2. **åˆ›å»ºæ–°Issue** - ä½¿ç”¨æä¾›çš„æ¨¡æ¿
3. **æä¾›è¯¦ç»†ä¿¡æ¯** - åŒ…æ‹¬ï¼š
   - é—®é¢˜æè¿°
   - å¤ç°æ­¥éª¤
   - é¢„æœŸè¡Œä¸º
   - å®é™…è¡Œä¸º
   - ç¯å¢ƒä¿¡æ¯ï¼ˆOSã€ç‰ˆæœ¬ç­‰ï¼‰
   - æ—¥å¿—å’Œæˆªå›¾

### æäº¤ä»£ç 

1. **Forké¡¹ç›®**
   ```bash
   # ç‚¹å‡»GitHubé¡µé¢çš„ForkæŒ‰é’®
   ```

2. **å…‹éš†ä»“åº“**
   ```bash
   git clone https://github.com/your-username/YuyuanWaf.git
   cd YuyuanWaf
   ```

3. **åˆ›å»ºåˆ†æ”¯**
   ```bash
   git checkout -b feature/your-feature-name
   # æˆ–
   git checkout -b fix/your-bug-fix
   ```

4. **å¼€å‘å’Œæµ‹è¯•**
   ```bash
   # è¿›è¡Œå¼€å‘
   # è¿è¡Œæµ‹è¯•
   bash tests/run_tests.sh
   ```

5. **æäº¤æ›´æ”¹**
   ```bash
   git add .
   git commit -m "feat: add new feature"
   ```

6. **æ¨é€åˆ°GitHub**
   ```bash
   git push origin feature/your-feature-name
   ```

7. **åˆ›å»ºPull Request**
   - è®¿é—®GitHubä»“åº“
   - ç‚¹å‡»"New Pull Request"
   - å¡«å†™PRæ¨¡æ¿
   - ç­‰å¾…å®¡æŸ¥

---

## å¼€å‘æµç¨‹

### ç¯å¢ƒæ­å»º

1. **å®‰è£…ä¾èµ–**
   ```bash
   # OpenResty
   brew install openresty  # macOS
   # æˆ–
   apt-get install openresty  # Ubuntu
   ```

2. **é…ç½®å¼€å‘ç¯å¢ƒ**
   ```bash
   # å¤åˆ¶é…ç½®æ–‡ä»¶
   cp conf/nginx.conf.example conf/nginx.conf
   
   # ä¿®æ”¹ä¸ºå¼€å‘é…ç½®
   vim conf/nginx.conf
   ```

3. **å¯åŠ¨æœåŠ¡**
   ```bash
   # ä½¿ç”¨Dockerï¼ˆæ¨èï¼‰
   docker-compose up -d
   
   # æˆ–ç›´æ¥å¯åŠ¨
   openresty -p /path/to/YuyuanWaf
   ```

### å¼€å‘å·¥ä½œæµ

1. **åŒæ­¥ä¸»ä»“åº“**
   ```bash
   git remote add upstream https://github.com/original/YuyuanWaf.git
   git fetch upstream
   git merge upstream/main
   ```

2. **åˆ›å»ºåŠŸèƒ½åˆ†æ”¯**
   ```bash
   git checkout -b feature/new-rule
   ```

3. **ç¼–å†™ä»£ç **
   - éµå¾ªä»£ç è§„èŒƒ
   - æ·»åŠ æ³¨é‡Š
   - ç¼–å†™æµ‹è¯•

4. **è¿è¡Œæµ‹è¯•**
   ```bash
   # å•å…ƒæµ‹è¯•
   bash tests/run_tests.sh
   
   # æ€§èƒ½æµ‹è¯•
   bash tests/performance/run_all_tests.sh
   ```

5. **æäº¤ä»£ç **
   ```bash
   git add .
   git commit -m "feat(rules): add new SQL injection rule"
   ```

---

## ä»£ç è§„èŒƒ

### Luaä»£ç è§„èŒƒ

```lua
-- 1. ä½¿ç”¨2ç©ºæ ¼ç¼©è¿›
local function example()
  local value = "test"
  return value
end

-- 2. å‡½æ•°å‘½åï¼šä½¿ç”¨ä¸‹åˆ’çº¿åˆ†éš”
local function check_sql_injection(str)
  -- ...
end

-- 3. å˜é‡å‘½åï¼šä½¿ç”¨ä¸‹åˆ’çº¿åˆ†éš”
local user_input = ngx.var.arg_id
local is_valid = true

-- 4. å¸¸é‡ï¼šä½¿ç”¨å¤§å†™
local MAX_RETRY = 3
local DEFAULT_TIMEOUT = 30

-- 5. æ¨¡å—ç»“æ„
local _M = {}

-- ç§æœ‰å‡½æ•°
local function private_helper()
  -- ...
end

-- å…¬å…±å‡½æ•°
function _M.public_method()
  -- ...
end

return _M
```

### æ³¨é‡Šè§„èŒƒ

```lua
-- ============================================================================
-- æ¨¡å—è¯´æ˜
-- ============================================================================

--- æ£€æŸ¥SQLæ³¨å…¥
-- @param str string å¾…æ£€æŸ¥çš„å­—ç¬¦ä¸²
-- @return boolean æ˜¯å¦åŒ…å«SQLæ³¨å…¥
-- @return string|nil åŒ¹é…çš„è§„åˆ™
function _M.check_sqli(str)
  -- å®ç°é€»è¾‘
  return false
end
```

### Nginxé…ç½®è§„èŒƒ

```nginx
# ä½¿ç”¨4ç©ºæ ¼ç¼©è¿›
http {
    # é…ç½®é¡¹æŒ‰å­—æ¯æ’åº
    access_log /var/log/nginx/access.log;
    error_log /var/log/nginx/error.log;
    
    # ç›¸å…³é…ç½®åˆ†ç»„
    lua_package_path "...";
    lua_shared_dict waf_cache 100m;
    
    # æ·»åŠ æ³¨é‡Šè¯´æ˜
    server {
        listen 80;
        server_name example.com;
        
        # WAFæ£€æŸ¥
        access_by_lua_block {
            -- ...
        }
    }
}
```

---

## æäº¤è§„èŒƒ

ä½¿ç”¨ [Conventional Commits](https://www.conventionalcommits.org/) è§„èŒƒï¼š

### æäº¤ç±»å‹

- `feat`: æ–°åŠŸèƒ½
- `fix`: Bugä¿®å¤
- `docs`: æ–‡æ¡£æ›´æ–°
- `style`: ä»£ç æ ¼å¼è°ƒæ•´
- `refactor`: é‡æ„
- `perf`: æ€§èƒ½ä¼˜åŒ–
- `test`: æµ‹è¯•ç›¸å…³
- `chore`: æ„å»º/å·¥å…·ç›¸å…³

### æäº¤æ ¼å¼

```
<type>(<scope>): <subject>

<body>

<footer>
```

### ç¤ºä¾‹

```bash
# æ–°åŠŸèƒ½
git commit -m "feat(rules): add XSS detection for SVG tags"

# Bugä¿®å¤
git commit -m "fix(rate-limit): correct token bucket calculation"

# æ–‡æ¡£æ›´æ–°
git commit -m "docs(readme): update installation guide"

# æ€§èƒ½ä¼˜åŒ–
git commit -m "perf(cache): improve cache hit rate by 20%"

# ç ´åæ€§å˜æ›´
git commit -m "feat(api): change config API endpoint

BREAKING CHANGE: /api/config moved to /api/v1/config"
```

---

## æµ‹è¯•è¦æ±‚

### å•å…ƒæµ‹è¯•

æ‰€æœ‰æ–°åŠŸèƒ½å¿…é¡»åŒ…å«å•å…ƒæµ‹è¯•ï¼š

```lua
-- tests/unit/test_new_feature.lua
local new_feature = require "new_feature"

describe("æ–°åŠŸèƒ½æµ‹è¯•", function()
    it("åº”è¯¥æ­£ç¡®æ£€æµ‹æ”»å‡»", function()
        local result = new_feature.check("attack payload")
        assert.is_true(result)
    end)
    
    it("ä¸åº”è¯¯æŠ¥æ­£å¸¸è¯·æ±‚", function()
        local result = new_feature.check("normal input")
        assert.is_false(result)
    end)
end)
```

### è¿è¡Œæµ‹è¯•

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
bash tests/run_tests.sh

# è¿è¡Œç‰¹å®šæµ‹è¯•
busted tests/unit/test_new_feature.lua

# è¿è¡Œæ€§èƒ½æµ‹è¯•
bash tests/performance/benchmark.sh
```

### æµ‹è¯•è¦†ç›–ç‡

- æ ¸å¿ƒåŠŸèƒ½ï¼š>80%
- è§„åˆ™å¼•æ“ï¼š>90%
- å·¥å…·å‡½æ•°ï¼š>70%

---

## Pull Requestæµç¨‹

### PRæ£€æŸ¥æ¸…å•

æäº¤PRå‰è¯·ç¡®ä¿ï¼š

- [ ] ä»£ç éµå¾ªé¡¹ç›®è§„èŒƒ
- [ ] æ·»åŠ äº†å¿…è¦çš„æµ‹è¯•
- [ ] æ‰€æœ‰æµ‹è¯•é€šè¿‡
- [ ] æ›´æ–°äº†ç›¸å…³æ–‡æ¡£
- [ ] æäº¤ä¿¡æ¯ç¬¦åˆè§„èŒƒ
- [ ] æ— å†²çª
- [ ] PRæè¿°æ¸…æ™°

### PRæ¨¡æ¿

```markdown
## å˜æ›´ç±»å‹
- [ ] æ–°åŠŸèƒ½
- [ ] Bugä¿®å¤
- [ ] æ–‡æ¡£æ›´æ–°
- [ ] æ€§èƒ½ä¼˜åŒ–
- [ ] é‡æ„

## å˜æ›´è¯´æ˜
ç®€è¦æè¿°æ­¤PRçš„ç›®çš„å’Œå®ç°æ–¹å¼

## ç›¸å…³Issue
Closes #123

## æµ‹è¯•
è¯´æ˜å¦‚ä½•æµ‹è¯•æ­¤å˜æ›´

## æˆªå›¾ï¼ˆå¦‚é€‚ç”¨ï¼‰
æ·»åŠ æˆªå›¾å±•ç¤ºæ•ˆæœ

## æ£€æŸ¥æ¸…å•
- [ ] ä»£ç éµå¾ªè§„èŒƒ
- [ ] æ·»åŠ äº†æµ‹è¯•
- [ ] æµ‹è¯•é€šè¿‡
- [ ] æ›´æ–°äº†æ–‡æ¡£
```

### å®¡æŸ¥æµç¨‹

1. **è‡ªåŠ¨æ£€æŸ¥** - CI/CDè¿è¡Œæµ‹è¯•
2. **ä»£ç å®¡æŸ¥** - ç»´æŠ¤è€…å®¡æŸ¥ä»£ç 
3. **è®¨è®ºåé¦ˆ** - æ ¹æ®åé¦ˆä¿®æ”¹
4. **åˆå¹¶** - å®¡æŸ¥é€šè¿‡ååˆå¹¶

---

## æ–‡æ¡£è´¡çŒ®

### æ–‡æ¡£ç±»å‹

- **README.md** - é¡¹ç›®ä»‹ç»
- **docs/** - è¯¦ç»†æ–‡æ¡£
- **ä»£ç æ³¨é‡Š** - å†…è”æ–‡æ¡£
- **ç¤ºä¾‹** - ä½¿ç”¨ç¤ºä¾‹

### æ–‡æ¡£è§„èŒƒ

```markdown
# æ ‡é¢˜ä½¿ç”¨ATXé£æ ¼

## ç« èŠ‚æ¸…æ™°

ä½¿ç”¨ç®€æ´çš„è¯­è¨€ã€‚

### ä»£ç ç¤ºä¾‹

\`\`\`lua
-- æä¾›å®Œæ•´å¯è¿è¡Œçš„ç¤ºä¾‹
local example = "test"
\`\`\`

### æ³¨æ„äº‹é¡¹

> ä½¿ç”¨å¼•ç”¨å—çªå‡ºé‡è¦ä¿¡æ¯

### åˆ—è¡¨

- é¡¹ç›®1
- é¡¹ç›®2
  - å­é¡¹ç›®2.1
  - å­é¡¹ç›®2.2
```

---

## ç¤¾åŒºæ”¯æŒ

### è·å–å¸®åŠ©

- **æ–‡æ¡£**: æŸ¥çœ‹ [docs/](docs/) ç›®å½•
- **Issue**: æœç´¢æˆ–åˆ›å»ºIssue
- **è®¨è®º**: ä½¿ç”¨GitHub Discussions
- **é‚®ä»¶**: support@yuyuanwaf.orgï¼ˆå¦‚æœ‰ï¼‰

### ä¿æŒè”ç³»

- **GitHub**: [@YuyuanWaf](https://github.com/YuyuanWaf)
- **å¾®ä¿¡ç¾¤**: æ‰«ç åŠ å…¥ï¼ˆæ·»åŠ äºŒç»´ç ï¼‰
- **Twitter**: [@YuyuanWaf](https://twitter.com/YuyuanWaf)

---

## è‡´è°¢

æ„Ÿè°¢æ‰€æœ‰è´¡çŒ®è€…ï¼

<!-- ALL-CONTRIBUTORS-LIST:START -->
<!-- è‡ªåŠ¨ç”Ÿæˆçš„è´¡çŒ®è€…åˆ—è¡¨ -->
<!-- ALL-CONTRIBUTORS-LIST:END -->

---

## è®¸å¯è¯

é€šè¿‡å‘æ­¤é¡¹ç›®è´¡çŒ®ï¼Œæ‚¨åŒæ„æ‚¨çš„è´¡çŒ®å°†åœ¨ä¸é¡¹ç›®ç›¸åŒçš„è®¸å¯è¯ä¸‹æˆæƒã€‚

---

**å†æ¬¡æ„Ÿè°¢æ‚¨çš„è´¡çŒ®ï¼** ğŸ‰

å¦‚æœ‰ä»»ä½•é—®é¢˜ï¼Œè¯·éšæ—¶è”ç³»ç»´æŠ¤è€…ã€‚

